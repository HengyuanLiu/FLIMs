# flimr-fl Project Documentation

## Project Overview

This project is a fault localization and repair system based on large language models (LLMs). It primarily consists of three core modules: prompt construction, LLM output generation, and confidence score calculation.

## Directory Structure

d:\Graduate\flimr-fl code

├── code\                   # Main code directory

│   ├── prompt-set\         # Prompt construction module

│   ├── llm-generation\     # LLM output generation module

│   └── confidence\         # Confidence score calculation module

└── readme.md               # Project documentation

## Module Details

### 1. Prompt Construction (code/prompt-set)

This module is responsible for constructing prompts for the large language model, mainly including the following files:

#### func-fault.py

**Function**: Maps error functions to their corresponding identifier codes

**Input Files**:

* file = rf'D:\Graduate\code\fault\BuggyMethod{bug}{bug}-{idex}.buggy.methods'
* file3 = rf"D:\code\mbfl data{bug}{idex}\killmaps{bug}{idex}\mutants.log"
* file2 = rf'D:\code\chain{bug}{idex}b\method-base.csv'

**Output Files**: Generates intermediate data containing error function information for subsequent prompt construction

#### kp-kf-c.py

**Function**: Calculates mutant suspicion scores and parameters such as akp and akf

**Input Files**: Error function information, test coverage data

* gzip_file_path =rf"D:\code\mbfl data{bug}{idex}\killmaps{bug}{idex}\killmap.csv.gz"

**Output Files**: Contains intermediate data with mutant suspicion scores, akp, akf, and other parameters

#### final-dataset.py

**Function**: Prompt construction code (same as fine-tuning dataset, except fine-tuning includes labels)

**Input Files**: Error function information, mutant data, test results

* file_path1=rf'D:\code\mbfl data{bug}{idex}\killmaps{bug}{idex}\killmap.csv.gz'
* file_path2=rf"D:\Graduate\code\result\dataset-512{bug}{idex}{bug}_{idex}.json"
* file_path3=rf"D:\code\mbfl data{bug}{idex}\killmaps{bug}{idex}\mutants.log"
* file_path4=rf"D:\Graduate\code\result\bug-mutant{bug}{bug}-{idex}.keys.txt"

**Output Files**: Constructed prompt dataset for LLM input or fine-tuning

### 2. LLM Output Generation (code/llm-generation)

This module is responsible for invoking, fine-tuning, and generating results from large language models, mainly including the following files:

#### llm-generation.py

**Function**: General LLM output based on prompts

**Input Files**: Prompt dataset generated by the prompt-set module

* model_name ="/home/wangdonghua/Qwen/deepseek-14b/deepseek-14B/deepseek-ai/DeepSeek-R1-Distill-Qwen-14B" (model path)
* file_path=f"/home/wangdonghua/Qwen/data/wt-dataset/{bug}/{bug}_{i}.json"

**Output Files**: Raw output results from the LLM, typically saved in the data/generation/ directory

#### llm-finetune.py

**Function**: Fine-tunes a general-purpose large language model

**Input Files**: Labeled fine-tuning dataset

* model_path="/home/wangdonghua/Deepseek/deepseek-ai/DeepSeek-R1-Distill-Qwen-14B" (model path)
* file_path=f"/home/wangdonghua/Qwen/data/wt-dataset/{bug}/{bug}_{i}.json"

**Output Files**: Fine-tuned model weights, saved in the specified model directory

#### finetuned-llm-generation.py

**Function**: Output results from the fine-tuned LLM

**Input Files**: Same prompt dataset as llm-generation.py

* model_name="/home/wangdonghua/Qwen/deepseek-14b/saved_model" (fine-tuned model path)
* file_path=f"/home/wangdonghua/Qwen/data/wt-dataset/{bug}/{bug}_{i}.json"

**Output Files**: Output results from the fine-tuned LLM, typically saved in the data/generation/ directory and distinguished from original model results

### 3. Confidence Score Calculation (code/confidence)

This module is responsible for analyzing the confidence of LLM output results and calculating the final fault localization results, mainly including the following files:

#### flim-record.py

**Function**: Extracts FLIM classification results from generated outputs

**Input Files**: LLM output result files

* file_path=rf'D:\Graduate\new-experimina\result\deepseek-8b\output{num}{bug}{bug} *{idex}* mutants.json'

**Output Files**: Classification result records, identifying the category of each mutant

#### zxd_Matrix.py

**Function**: Calculates the confidence score matrix result (n rows × 5 columns)

**Input Files**: Classification result records, test coverage data

**Output Files**: Confidence score matrix file, recording confidence-related parameters for each mutant

#### p-f-wkill.py

**Function**: Calculates the confidence weight for each mutant based on the matrix

**Input Files**: Confidence score matrix file

* input_path=rf"D:\Graduate\new-experimina\result\deepseek-8b\wkill_matrix{bug}{bug} *{i}* wkill_matrix.csv"

**Output Files**: Mutant confidence weight file, recording the weight value for each mutant

#### p-f-new.py

**Function**: Updates the mutant suspicion scores

**Input Files**: Original mutant suspicion scores, confidence weight results

* file_csv=os.path.join(rf"D:\Graduate\new-experimina\result\deepseek-8b\p-f-pca", bug, f"pf_{i}.csv")
* file_xlsx=os.path.join(fr"D:\Graduate\code\result\error1", bug, str(i), f"pf_{i}.xlsx")

**Output Files**: Updated mutant suspicion score file, used for final fault localization

## Data Flow

1. The prompt construction module generates a prompt dataset from external error function files
2. The LLM output generation module uses the prompt dataset to generate model outputs
3. The confidence score calculation module analyzes the model outputs, calculates confidence weights, and updates mutant suspicion scores

## Notes

1. Ensure all input file paths are correct before running the code
2. There are dependencies between modules; please execute them in order
3. Intermediate files and result files will be saved in their respective data directories

